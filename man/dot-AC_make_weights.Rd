% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/GwetAC2.R
\name{.AC_make_weights}
\alias{.AC_make_weights}
\title{Gwet's AC2 for Multiple Raters (Ordinal / Weighted)}
\usage{
.AC_make_weights(K, type = c("linear", "quadratic", "unweighted"), w = NULL)
}
\arguments{
\item{w}{For \code{weights="custom"}: a \eqn{K \times K} numeric matrix with
entries in \eqn{[0,1]} and unit diagonal; otherwise ignored.}

\item{x}{For the default method: an \eqn{n \times m} matrix (or data.frame)
of ratings where rows are subjects and columns are raters. Entries are
ordinal categories (factor/character/integers); \code{NA} allowed.}

\item{weights}{Type of weights: one of \code{"linear"}, \code{"quadratic"},
\code{"unweighted"} (i.e., identity), or \code{"custom"}.}

\item{ci}{One of \code{"none"}, \code{"asymptotic"} (delta method), or \code{"bootstrap"}.}

\item{conf.level}{Confidence level for the interval (default \code{0.95}).}

\item{B}{Number of bootstrap replicates when \code{ci = "bootstrap"} (default \code{1000}).}

\item{seed}{Optional random seed for bootstrap reproducibility.}

\item{...}{Further arguments passed to \code{LongToSquare()} in the formula method.}
}
\value{
An object of class \code{"htest"} with elements:
\item{statistic}{Named numeric: \code{AC2}.}
\item{estimate}{Named vector with \code{Po.w} (weighted observed) and
\code{S} (weighted prevalence term \eqn{p^\top W p}).}
\item{parameter}{Named vector with \code{subjects} and \code{raters.eff}
(average number of valid ratings per subject).}
\item{conf.int}{Confidence interval for AC2 if requested.}
\item{method}{Method string.}
\item{data.name}{Description of the data.}
}
\description{
Computes Gwet's AC2 agreement coefficient for \emph{m >= 2} raters with
ordinal (or more generally, weighted) categories, allowing missing ratings.
Supports a formula interface \code{y ~ id | rater} (long format) via
\code{LongToSquare()} and a default method that accepts a subject-by-rater
matrix. Confidence intervals are available via an asymptotic delta-method
variance and via nonparametric bootstrap over subjects.
}
\details{
Let \eqn{n} be the number of subjects and \eqn{m_s} the number of valid
ratings for subject \eqn{s}. With a \eqn{K \times K} weight matrix
\eqn{W=(w_{cd})} (diagonal 1, off-diagonal in \eqn{[0,1]}), the subject-wise
weighted observed agreement is
\deqn{A_s^{(w)} = \frac{\sum_{c,d} w_{cd} n_{sc} n_{sd} - \sum_c w_{cc} n_{sc}}
                       {m_s (m_s - 1)} ,}
where \eqn{n_{sc}} is the number of raters assigning category \eqn{c} to
subject \eqn{s}. The overall observed agreement is
\eqn{P_o^{(w)} = \frac{1}{n}\sum_s A_s^{(w)}}.

Let \eqn{p} be the vector of overall category prevalences across all ratings
(all raters and subjects). Define \eqn{S = p^\top W p} and
\eqn{P_e^{(w)} = 1 - S}. Then the AC2 coefficient is
\deqn{AC2 = \frac{P_o^{(w)} - P_e^{(w)}}{1 - P_e^{(w)}} = \frac{P_o^{(w)} + S - 1}{S}.}
For \eqn{W = I_K} (unweighted), this reduces to AC1.

The asymptotic variance uses a subject-level delta method based on the
contributions \eqn{(A_s^{(w)}, n_{s1}/\bar m, \dots, n_{sK}/\bar m)} with
\eqn{\bar m} the average number of ratings per subject.
}
\examples{
# Beispiel: 5 Subjekte x 4 Rater, Ordnung V < N < P
d.ratings <- data.frame(
  subj = c("1","2","3","4","5"),
  rtr1 = factor(c("V","V","V","V","P"), levels=c("V","N","P"), ordered=TRUE),
  rtr2 = factor(c("V","N","V","V","P"), levels=c("V","N","P"), ordered=TRUE),
  rtr3 = factor(c("V","P","V","V","P"), levels=c("V","N","P"), ordered=TRUE),
  rtr4 = factor(c("V","V","V","V","N"), levels=c("V","N","P"), ordered=TRUE)
)
d.long <- reshape(d.ratings, varying=2:5, idvar="subj",
                  times=names(d.ratings)[2:5],
                  v.names="rat", timevar="rater",
                  direction="long",
                  new.row.names=seq(prod(dim(d.ratings))))

# Formel-Interface (linear/quadratisch)
AC2(rat ~ subj | rater, data = d.long, weights="linear", ci="asymptotic")
AC2(rat ~ subj | rater, data = d.long, weights="quadratic",
    ci="bootstrap", B=500, seed=1)

# Custom-Gewichte
X <- as.matrix(d.ratings[,-1])
K <- length(levels(X[,1]))
D <- as.matrix(dist(seq_len(K), method="manhattan"))
W <- 1 - (D / max(D))     # lineare Gewichte als Beispiel
diag(W) <- 1
AC2(X, weights="custom", w=W, ci="asymptotic")

}
